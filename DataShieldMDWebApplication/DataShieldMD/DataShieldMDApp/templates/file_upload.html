{% extends 'partials/base.html' %}
{% block content %}
<div class="file-upload-container">
    <h2>{{ user.username }}'s File Upload Page</h2>
    <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        <div class="file-upload">
            <label for="file-input" class="file-label">Choose a file</label>
            <input type="file" id="file-input" name="file" hidden>
            <span id="file-name">No file selected</span>
        </div>
        <button type="submit" class="btn">Upload</button>
    </form>

    <h3>Your Uploaded Files</h3>
    <form method="get" class="search-form">
        <input type="text" name="search" placeholder="Search files" value="{{ request.GET.search }}">
        <button type="submit" class="btn">Search</button>
    </form>

    <table>
        <thead>
            <tr>
                <th>File Name</th>
                <th>Upload Date</th>
            </tr>
        </thead>
        <tbody>
            {% for file in page_obj.object_list %}
            <tr>
                <td>{{ file.filename }}</td>
                <td>{{ file.upload_date }}</td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="2" class="empty">No files found</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    
    <!-- Pagination Controls -->
    <div class="pagination">
        <span class="step-links">
            {% if page_obj.has_previous %}
                <a href="?page=1{% if search_query %}&search={{ search_query }}{% endif %}">&laquo; first</a>
                <a href="?page={{ page_obj.previous_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}">previous</a>
            {% endif %}
    
            <span class="current">
                Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}
            </span>
    
            {% if page_obj.has_next %}
                <a href="?page={{ page_obj.next_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}">next</a>
                <a href="?page={{ page_obj.paginator.num_pages }}{% if search_query %}&search={{ search_query }}{% endif %}">last &raquo;</a>
            {% endif %}
        </span>
    </div>
</div>
<script>
    document.getElementById('file-input').addEventListener('change', function () {
        const fileNameSpan = document.getElementById('file-name');
        const fileName = this.files[0] ? this.files[0].name : 'No file selected';
        fileNameSpan.textContent = fileName;
    });
</script>
{% endblock %}
